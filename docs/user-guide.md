# 网络小说智能问答系统 - 用户手册

## 📖 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [功能使用](#功能使用)
4. [常见问题](#常见问题)
5. [注意事项](#注意事项)

---

## 系统简介

网络小说智能问答系统是一个基于RAG（检索增强生成）技术的智能问答平台，专门为网络小说阅读和分析设计。系统能够理解小说内容，回答读者关于情节、角色、时间线等各类问题，并提供可视化的关系图谱和事件时间线。

### 核心特性

- **📚 小说管理**：支持TXT和EPUB格式的小说上传和管理
- **🤖 智能问答**：基于GraphRAG和Self-RAG技术的高准确率问答
- **📖 在线阅读**：分章节浏览，支持超长章节（10万字+）
- **🕸️ 知识图谱**：自动提取角色关系，展示关系演变
- **🎭 诡计识别**：检测叙述诡计和矛盾信息
- **📊 可视化分析**：角色关系图、事件时间线可视化
- **💰 成本控制**：Token使用统计、多模型切换

### 技术架构

- **前端**：Next.js 14 + React + TypeScript + Tailwind CSS
- **后端**：FastAPI + Python 3.12
- **AI引擎**：智谱AI（GLM-4系列 + Embedding-3）
- **向量数据库**：ChromaDB
- **知识图谱**：NetworkX
- **中文NLP**：HanLP

---

## 快速开始

### 系统要求

- **浏览器**：Chrome/Edge 90+、Firefox 88+、Safari 14+
- **网络**：需要稳定的互联网连接（用于AI模型调用）
- **设备**：推荐使用桌面或平板设备

### 首次使用

#### 1. 访问系统

打开浏览器，访问系统地址（默认：`http://localhost:3000`）

#### 2. 上传小说

1. 点击首页的"📚 管理小说"按钮
2. 点击"上传新小说"
3. 选择TXT或EPUB格式的小说文件
4. 等待上传和索引完成（可能需要几分钟）

#### 3. 开始提问

1. 上传完成后，点击"开始问答"
2. 在问答页面选择要查询的小说
3. 输入您的问题，点击"发送"
4. 系统将实时返回答案

---

## 功能使用

### 1. 小说管理

#### 1.1 上传小说

**步骤：**
1. 进入"小说管理"页面
2. 点击"上传新小说"按钮
3. 选择小说文件（支持TXT和EPUB）
4. 等待上传进度完成

**注意事项：**
- TXT文件需使用UTF-8编码
- EPUB文件需符合标准规范
- 建议单个文件不超过100MB
- 系统会自动检测章节分隔

#### 1.2 查看小说列表

- 小说列表显示所有已上传的小说
- 每个小说卡片显示：标题、作者、字数、章节数、上传时间
- 支持搜索和筛选

#### 1.3 删除小说

1. 在小说列表中找到要删除的小说
2. 点击"删除"按钮
3. 确认删除操作
4. 系统将删除小说及其所有索引数据

---

### 2. 智能问答

#### 2.1 提问方式

**支持的问题类型：**

1. **事实类问题**
   - "张三是谁？"
   - "第五章发生了什么？"
   - "主角的武器是什么？"

2. **分析类问题**
   - "张三和李四是什么关系？"
   - "主角的性格特点是什么？"
   - "这个故事的主题是什么？"

3. **对话类问题**
   - "帮我总结一下前十章的内容"
   - "解释一下这个设定"
   - "这个情节合理吗？"

#### 2.2 查看答案

- 答案会流式显示（逐字输出）
- 答案会标注**引用来源**（章节和段落）
- 如果检测到矛盾信息，会显示**矛盾提示**

#### 2.3 矛盾信息处理

当系统检测到矛盾时，会显示：

- **矛盾类型**：人物描述矛盾、时间线矛盾、事件矛盾等
- **早期描述**：矛盾的早期版本（章节+内容）
- **晚期描述**：矛盾的晚期版本（章节+内容）
- **修正建议**：系统给出的合理解释或修正

**示例：**
```
⚠️ 检测到矛盾信息

类型：人物描述矛盾
早期（第3章）："张三身高180cm"
晚期（第15章）："张三只有170cm"

修正建议：可能是作者笔误，以早期描述为准。
```

---

### 3. 在线阅读

#### 3.1 章节导航

1. 进入"在线阅读"页面
2. 选择要阅读的小说
3. 从章节列表选择章节
4. 使用"上一章"/"下一章"按钮导航

#### 3.2 阅读设置

- **字体大小**：支持调整阅读字号
- **主题**：支持明亮/暗黑模式切换
- **分页/滚动**：选择喜欢的阅读方式

---

### 4. 可视化分析

#### 4.1 角色关系图

**功能说明：**
- 自动提取小说中的角色和关系
- 可视化展示角色网络
- 支持查看关系演变（按章节范围）

**使用方法：**
1. 进入"可视化分析"页面
2. 选择"角色关系图"标签
3. 调整章节范围滑块
4. 查看关系图变化

**交互操作：**
- **鼠标悬停**：查看角色详细信息
- **点击节点**：高亮相关关系
- **拖拽节点**：调整布局
- **缩放**：鼠标滚轮或触控板

#### 4.2 事件时间线

**功能说明：**
- 按时间顺序展示重要事件
- 支持多视角时间线（不同角色）
- 自动检测时间跳跃和闪回

**使用方法：**
1. 选择"事件时间线"标签
2. 选择要查看的角色（可多选）
3. 浏览时间线

**时间线元素：**
- **事件节点**：显示事件描述和章节
- **连接线**：表示时间流动
- **时间标记**：显示相对或绝对时间

---

### 5. 模型管理

#### 5.1 模型切换

**可用模型：**
- **GLM-4-Flash**：速度快、成本低（推荐日常使用）
- **GLM-4-Air**：平衡性能和成本
- **GLM-4-AirX**：更强的理解能力
- **GLM-4-Plus**：最强性能（适合复杂问题）
- **GLM-4-Long**：超长上下文（百万级Token）

**切换方法：**
1. 进入"设置"页面
2. 选择"模型配置"
3. 从下拉列表选择模型
4. 点击"保存"

#### 5.2 API密钥配置

**获取API密钥：**
1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
2. 注册并登录
3. 在"API Keys"页面创建密钥

**配置密钥：**
1. 进入"设置" > "模型配置"
2. 输入API密钥
3. 点击"测试连接"验证
4. 保存配置

---

### 6. Token统计

#### 6.1 查看统计

进入"设置" > "Token统计"页面，查看：

- **总Token数**：累计使用的Token数量
- **输入/输出比例**：Prompt和Completion的占比
- **成本估算**：根据官方定价计算的费用
- **使用趋势**：按时间的使用曲线

#### 6.2 成本优化建议

1. **使用轻量模型**：日常问题使用GLM-4-Flash
2. **精简问题**：避免冗长的提问
3. **限制上下文**：不需要时关闭历史记录
4. **批量操作**：一次性处理多个问题

---

## 常见问题

### Q1: 上传的小说无法解析章节怎么办？

**A:** 
- 检查文件编码是否为UTF-8
- 确认章节标题格式（如"第一章"、"Chapter 1"）
- 尝试手动编辑章节分隔符
- 联系管理员添加自定义分隔规则

### Q2: 系统回答不准确或答非所问？

**A:**
- 尝试重新表述问题，使其更具体
- 切换到更强大的模型（如GLM-4-Plus）
- 检查小说是否已完整索引
- 查看是否有矛盾信息提示

### Q3: 关系图显示不完整？

**A:**
- 调整章节范围，查看完整图谱
- 某些角色可能在特定章节才出现
- 系统可能过滤了次要角色（可在设置中调整）

### Q4: 如何重新索引小说？

**A:**
1. 删除现有小说
2. 重新上传文件
3. 系统会自动重新索引

### Q5: Token消耗过快怎么办？

**A:**
- 切换到轻量模型（GLM-4-Flash）
- 减少每次查询的相关段落数（在设置中调整）
- 避免频繁重复查询
- 使用缓存功能（系统会自动缓存常见问题）

### Q6: 系统支持哪些小说类型？

**A:** 
系统支持所有中文小说，特别优化了：
- 悬疑推理小说（叙述诡计检测）
- 长篇连载小说（人物关系追踪）
- 架空奇幻小说（设定理解）

### Q7: 移动端能否使用？

**A:**
- 支持移动浏览器访问
- 部分可视化功能在小屏幕上体验较差
- 推荐使用平板或桌面设备

---

## 注意事项

### 数据隐私

- 所有上传的小说仅存储在本地服务器
- 问答记录不会上传到第三方服务器
- AI调用会将查询内容发送到智谱AI API（符合其隐私政策）

### 版权声明

- 请勿上传未经授权的版权作品
- 本系统仅供学习研究使用
- 用户需自行承担版权责任

### 性能建议

- **小说大小**：建议单本小说<500万字
- **并发查询**：避免同时对多本小说提问
- **浏览器缓存**：定期清理缓存以获得最佳性能

### 已知限制

1. **章节检测**：非标准格式的小说可能无法正确分章
2. **人名识别**：复杂或罕见的人名可能识别不准确
3. **时间推理**：相对时间（"三天后"）可能无法精确定位
4. **方言俚语**：方言对话可能影响理解准确度

### 系统维护

- 定期备份重要数据
- 及时更新到最新版本
- 监控磁盘空间（索引文件较大）

---

## 技术支持

如遇到问题或需要帮助：

1. 查看本用户手册
2. 查看[开发文档](./development.md)
3. 提交Issue到GitHub仓库
4. 联系系统管理员

---

**最后更新**: 2025-11-13  
**文档版本**: v1.0  
**系统版本**: v0.1.0
